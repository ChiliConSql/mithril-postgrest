/*
    A Mithril.js plugin to authenticate requests against PostgREST
    Copyright (c) 2007 - 2015 Diogo Biazus
    Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
    Version: 1.0.0
*/
!function(a){"object"==typeof exports?a(require("mithril"),require("underscore"),require("node-localstorage")):a(m,_,localStorage)}(function(a,b,c){var d={},e=function(a){return a.setRequestHeader("Authorization","Bearer "+f()),a},f=function(){return c.getItem("postgrest.token")};d.reset=function(){c.removeItem("postgrest.token")},d.init=function(g,h){return d.request=function(c){return a.request(b.extend(c,{url:g+c.url}))},d.requestWithToken=function(c){return a.postgrest.authenticate().then(function(d){var f=b.isFunction(c.config)?b.compose(c.config,e):e;return a.postgrest.request(b.extend(c,{config:f}))})},d.authenticate=function(){var b=a.deferred();return f()?b.resolve({token:f()}):a.request(h).then(function(a){c.setItem("postgrest.token",a.token),b.resolve({token:a.token})}),b.promise},d},a.postgrest=d});