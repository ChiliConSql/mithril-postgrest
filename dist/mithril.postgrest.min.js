"use strict";!function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){var n={},r=e.prop(),o=function(e,n){return n&&t.isFunction(n.config)?t.compose(n.config,e):e},u=function(e){return function(n){return t.each(e,function(e,t){n.setRequestHeader(t,e)}),n}},i=function(e,n){return t.extend({},n,{config:o(u(e),n)})},s={Prefer:"return=representation"};n.token=r,n.loader=function(n,r){var o=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],u=e.prop(o),i=e.deferred();return u.load=function(){return u(!0),e.redraw(),e.startComputation(),r(t.extend({},n,{background:!0})).then(function(t){u(!1),i.resolve(t),e.endComputation()},function(t){u(!1),i.reject(t),e.endComputation()}),i.promise},u},n.loaderWithToken=function(e,t){return n.loader(e,n.requestWithToken,t)},n.init=function(o,a){return n.request=function(n){return e.request(t.extend({},n,{url:o+n.url}))},n.authenticate=function(){var t=e.deferred();return r()?t.resolve({token:r()}):e.request(a).then(function(e){r(e.token),t.resolve({token:r()})},function(e){t.reject(e)}),t.promise},n.requestWithToken=function(t){return e.postgrest.authenticate().then(function(){return e.postgrest.request(i({Authorization:"Bearer "+r()},t))},function(){return e.postgrest.request(t)})},n.model=function(r){var o=function(e,t){if(t){var n=function(){var n=(e-1)*t,r=n+t-1;return n+"-"+r};return{"Range-unit":"items",Range:n()}}},a=e.prop(10),c={url:"/"+r},d=function(e,n,r,u){var s=arguments.length<=4||void 0===arguments[4]?{}:arguments[4],a=t.extend({},{Prefer:"count=none"},s,o(n,r));return i(a,t.extend({},u,c,{method:"GET",data:e}))},g=function(t,n){return n.url+="?"+e.route.buildQueryString(t),n},p=function(n){return e.postgrest.request(t.extend({},n,c,{method:"OPTIONS"}))},f=function(e,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=t.extend({},s,r);return i(o,t.extend({},n,c,{method:"POST",data:e}))},l=function(e,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=u(t.extend({},r));return g(e,i(o,t.extend({},n,c,{method:"DELETE"})))},m=function(e,n,r){var o=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],u=t.extend({},s,o);return g(e,i(u,t.extend({},r,c,{method:"PATCH",data:n})))},h=function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];return d(e,t||1,a(),n,r)},v=function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return d(e,1,1,t,n)};return{pageSize:a,getPageOptions:h,getRowOptions:v,patchOptions:m,postOptions:f,deleteOptions:l,getPage:t.compose(n.request,h),getRow:t.compose(n.request,v),patch:t.compose(n.request,m),post:t.compose(n.request,f),deleteRequest:t.compose(n.request,l),getPageWithToken:t.compose(n.requestWithToken,h),getRowWithToken:t.compose(n.requestWithToken,v),patchWithToken:t.compose(n.requestWithToken,m),postWithToken:t.compose(n.requestWithToken,f),deleteWithToken:t.compose(n.requestWithToken,l),options:p}},n},e.postgrest=n}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.filtersVM=function(n){var r={},o=function(){var n=e.prop(""),o=function(e){return arguments.length>0?(n(e),r):n()};return o.toFilter=function(){return t.isString(o())?o().trim():o()},o},u=t.reduce(n,function(e,t,n){return"between"===t?e[n]={lte:o(),gte:o()}:e[n]=o(),e},{order:e.prop()}),i=function(){return t.reduce(u,function(e,r,o){if("order"!==o){var u=n[o];if(t.isFunction(r.toFilter)&&(void 0===r.toFilter()||""===r.toFilter()))return e;if("ilike"===u||"like"===u)e[o]=u+".*"+r.toFilter()+"*";else if("@@"===u)e[o]=u+"."+r.toFilter().replace(/\s+/g,"&");else if("between"===u){if(!r.lte.toFilter()&&!r.gte.toFilter())return e;e[o]=[],r.gte()&&e[o].push("gte."+r.gte.toFilter()),r.lte()&&e[o].push("lte."+r.lte.toFilter())}else e[o]=u+"."+r.toFilter()}return e},{})},s=function(){var e=function(){return u.order()&&t.reduce(u.order(),function(e,t,n){return e.push(n+"."+t),e},[]).join(",")},n=e()?{order:e()}:{};return t.extend({},n,i())};return t.extend(r,u,{parameters:s,parametersWithoutOrder:i})}}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.paginationVM=function(n,r){var o=arguments.length<=2||void 0===arguments[2]?!0:arguments[2],u=e.prop([]),i=new RegExp("(d+)-(d+)?/?(d+)"),s=r||"id.desc",a=e.prop({order:s}),c=e.prop(!1),d=e.prop(1),g=e.prop(10),p=o?n.getPageWithToken:n.getPage,f=e.prop(),l=function(){var n=e.deferred(),r=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var n=e.getResponseHeader("Content-Range");if(t.isString(n)){var r=i.exec(n);f(parseInt(r[2])),g(parseInt(r[0])-parseInt(r[1]))}try{return JSON.parse(e.responseText),e.responseText}catch(o){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return c(!0),p(a(),d(),{background:!0,extract:r},{Prefer:"count=exact"}).then(function(r){u(t.union(u(),r)),c(!1),n.resolve(u()),e.redraw()},function(t){c(!1),f(0),n.reject(t),e.redraw()}),n.promise},m=function(e){return a(t.extend({order:s},e)),u([]),d(1),l()},h=function(){return d()*n.pageSize()>=f()},v=function(){return d(d()+1),l()};return{collection:u,firstPage:m,isLoading:c,nextPage:v,isLastPage:h,total:f}}});