!function(e){"object"==typeof exports?e(require("mithril"),require("underscore"),require("node-localstorage")):e(window.m,window._,window.localStorage)}(function(e,t,r){var n={},o=function(e){return e?r.setItem("postgrest.token",e):r.getItem("postgrest.token")},i=function(e,r){return r&&t.isFunction(r.config)?t.compose(r.config,e):e},u=function(e){return function(r){return t.each(e,function(e,t){r.setRequestHeader(t,e)}),r}},s=u({Prefer:"return=representation"});n.reset=function(){r.removeItem("postgrest.token")},n.loader=function(r,n,o){var o=o||!1,i=e.prop(o),u=e.deferred();return i.load=function(){return i(!0),e.redraw(),e.startComputation(),n(t.extend({},r,{background:!0})).then(function(t){i(!1),u.resolve(t),e.endComputation()},function(t){i(!1),u.reject(t),e.endComputation()}),u.promise},i},n.loaderWithToken=function(e,t){return n.loader(e,n.requestWithToken,t)},n.init=function(r,c){return n.onAuthFailure=e.prop(function(){}),n.request=function(n){return e.request(t.extend({},n,{url:r+n.url}))},n.authenticate=function(){var t=e.deferred();return o()?(t.resolve({token:o()}),t.promise):e.request(c).then(function(e){o(e.token)},n.onAuthFailure())},n.requestWithToken=function(r){var n=u({Authorization:"Bearer "+o()});return e.postgrest.authenticate().then(function(){return e.postgrest.request(t.extend({},r,{config:i(n,r)}))})},n.model=function(r){var o=function(e,t){var r=function(){var r=(e-1)*t,n=r+t-1;return r+"-"+n};return u({"Range-unit":"items",Range:r()})},c=e.prop(10),p={url:"/"+r},a=function(e,r,n,u){return t.extend({},u,p,{method:"GET",data:e,config:i(o(r,n),u)})},f=function(t,r){return r.url+="?"+e.route.buildQueryString(t),r},d=function(r){return e.postgrest.request(t.extend({},r,p,{method:"OPTIONS"}))},l=function(e,r){return t.extend({},r,p,{method:"POST",data:e,config:i(s,r)})},g=function(e,r){return f(e,t.extend({},r,p,{method:"DELETE"}))},h=function(e,r,n){return f(e,t.extend({},n,p,{method:"PATCH",data:r,config:i(s,n)}))},m=function(e,t,r){return a(e,t||1,c(),r)},q=function(e,t){return a(e,1,1,t)};return{pageSize:c,getPageOptions:m,getRowOptions:q,patchOptions:h,postOptions:l,deleteOptions:g,getPage:t.compose(n.request,m),getRow:t.compose(n.request,q),patch:t.compose(n.request,h),post:t.compose(n.request,l),deleteRequest:t.compose(n.request,g),getPageWithToken:t.compose(n.requestWithToken,m),getRowWithToken:t.compose(n.requestWithToken,q),patchWithToken:t.compose(n.requestWithToken,h),postWithToken:t.compose(n.requestWithToken,l),deleteWithToken:t.compose(n.requestWithToken,g),options:d}},n},e.postgrest=n}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.filtersVM=function(r){var n=function(){var t=e.prop("");return t.toFilter=function(){return(t()||"").toString().trim()},t},o=t.reduce(r,function(e,t,r){return"between"===t?e[r]={lte:n(),gte:n()}:e[r]=n(),e},{order:e.prop()}),i=function(){return t.reduce(o,function(e,n,o){if("order"!==o){var i=r[o];if(t.isFunction(n.toFilter)&&!n.toFilter())return e;if("ilike"===i||"like"===i)e[o]=i+".*"+n.toFilter()+"*";else if("@@"===i)e[o]=i+"."+n.toFilter().replace(/\s+/g,"&");else if("between"===i){if(!n.lte.toFilter()&&!n.gte.toFilter())return e;e[o]=[],n.gte()&&e[o].push("gte."+n.gte.toFilter()),n.lte()&&e[o].push("lte."+n.lte.toFilter())}else e[o]=i+"."+n.toFilter()}return e},{})},u=function(){var e=function(){return o.order()&&t.reduce(o.order(),function(e,t,r){return e.push(r+"."+t),e},[]).join(",")},r=e()?{order:e()}:{};return t.extend({},r,i())};return t.extend({},o,{parameters:u,parametersWithoutOrder:i})}}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.paginationVM=function(r,n){var o=e.prop([]),i=n||"id.desc",u=e.prop({order:i}),s=e.prop(!1),c=e.prop(1),p=e.prop(),a=function(){var n=e.deferred(),i=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var r=e.getResponseHeader("Content-Range");t.isString(r)&&r.split("/").length>1&&p(parseInt(r.split("/")[1]));try{return JSON.parse(e.responseText),e.responseText}catch(n){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return s(!0),r(u(),c(),{background:!0,extract:i}).then(function(r){o(t.union(o(),r)),s(!1),n.resolve(o()),e.redraw()},function(t){s(!1),p(0),n.reject(t),e.redraw()}),n.promise},f=function(e){return u(t.extend({order:i},e)),o([]),c(1),a()},d=function(){return c(c()+1),a()};return{collection:o,firstPage:f,isLoading:s,nextPage:d,total:p}}});