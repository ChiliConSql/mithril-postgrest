"use strict";!function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){var r={},n=e.prop(),o=function(e,r){return r&&t.isFunction(r.config)?t.compose(r.config,e):e},i=function(e){return function(r){return t.each(e,function(e,t){r.setRequestHeader(t,e)}),r}},u=i({Prefer:"return=representation"});r.token=n,r.loader=function(r,n){var o=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],i=e.prop(o),u=e.deferred();return i.load=function(){return i(!0),e.redraw(),e.startComputation(),n(t.extend({},r,{background:!0})).then(function(t){i(!1),u.resolve(t),e.endComputation()},function(t){i(!1),u.reject(t),e.endComputation()}),u.promise},i},r.loaderWithToken=function(e,t){return r.loader(e,r.requestWithToken,t)},r.init=function(s,c){return r.request=function(r){return e.request(t.extend({},r,{url:s+r.url}))},r.authenticate=function(){var t=e.deferred();return n()?t.resolve({token:n()}):e.request(c).then(function(e){n(e.token),t.resolve({token:n()})},function(e){t.reject(e)}),t.promise},r.requestWithToken=function(r){var u=function(){return o(i({Authorization:"Bearer "+n()}),r)};return e.postgrest.authenticate().then(function(){return e.postgrest.request(t.extend({},r,{config:u()}))},function(){return e.postgrest.request(t.extend({},r))})},r.model=function(n){var s=function(e,t){var r=function(){var r=(e-1)*t,n=r+t-1;return r+"-"+n};return i({"Range-unit":"items",Range:r()})},c=e.prop(10),p={url:"/"+n},a=function(e,r,n,i){return t.extend({},i,p,{method:"GET",data:e,config:o(s(r,n),i)})},f=function(t,r){return r.url+="?"+e.route.buildQueryString(t),r},d=function(r){return e.postgrest.request(t.extend({},r,p,{method:"OPTIONS"}))},l=function(e,r){return t.extend({},r,p,{method:"POST",data:e,config:o(u,r)})},g=function(e,r){return f(e,t.extend({},r,p,{method:"DELETE"}))},h=function(e,r,n){return f(e,t.extend({},n,p,{method:"PATCH",data:r,config:o(u,n)}))},m=function(e,t,r){return a(e,t||1,c(),r)},q=function(e,t){return a(e,1,1,t)};return{pageSize:c,getPageOptions:m,getRowOptions:q,patchOptions:h,postOptions:l,deleteOptions:g,getPage:t.compose(r.request,m),getRow:t.compose(r.request,q),patch:t.compose(r.request,h),post:t.compose(r.request,l),deleteRequest:t.compose(r.request,g),getPageWithToken:t.compose(r.requestWithToken,m),getRowWithToken:t.compose(r.requestWithToken,q),patchWithToken:t.compose(r.requestWithToken,h),postWithToken:t.compose(r.requestWithToken,l),deleteWithToken:t.compose(r.requestWithToken,g),options:d}},r},e.postgrest=r}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.filtersVM=function(r){var n={},o=function(){var r=e.prop(""),o=function(e){return arguments.length>0?(r(e),n):r()};return o.toFilter=function(){return t.isString(o())?o().trim():o()},o},i=t.reduce(r,function(e,t,r){return"between"===t?e[r]={lte:o(),gte:o()}:e[r]=o(),e},{order:e.prop()}),u=function(){return t.reduce(i,function(e,n,o){if("order"!==o){var i=r[o];if(t.isFunction(n.toFilter)&&(void 0===n.toFilter()||""===n.toFilter()))return e;if("ilike"===i||"like"===i)e[o]=i+".*"+n.toFilter()+"*";else if("@@"===i)e[o]=i+"."+n.toFilter().replace(/\s+/g,"&");else if("between"===i){if(!n.lte.toFilter()&&!n.gte.toFilter())return e;e[o]=[],n.gte()&&e[o].push("gte."+n.gte.toFilter()),n.lte()&&e[o].push("lte."+n.lte.toFilter())}else e[o]=i+"."+n.toFilter()}return e},{})},s=function(){var e=function(){return i.order()&&t.reduce(i.order(),function(e,t,r){return e.push(r+"."+t),e},[]).join(",")},r=e()?{order:e()}:{};return t.extend({},r,u())};return t.extend(n,i,{parameters:s,parametersWithoutOrder:u})}}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.paginationVM=function(r,n){var o=e.prop([]),i=n||"id.desc",u=e.prop({order:i}),s=e.prop(!1),c=e.prop(1),p=e.prop(),a=function(){var n=e.deferred(),i=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var r=e.getResponseHeader("Content-Range");t.isString(r)&&r.split("/").length>1&&p(parseInt(r.split("/")[1]));try{return JSON.parse(e.responseText),e.responseText}catch(n){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return s(!0),r(u(),c(),{background:!0,extract:i}).then(function(r){o(t.union(o(),r)),s(!1),n.resolve(o()),e.redraw()},function(t){s(!1),p(0),n.reject(t),e.redraw()}),n.promise},f=function(e){return u(t.extend({order:i},e)),o([]),c(1),a()},d=function(){return c(c()+1),a()};return{collection:o,firstPage:f,isLoading:s,nextPage:d,total:p}}});