"use strict";!function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){var n={},r=e.prop(),o=function(e,n){return n&&t.isFunction(n.config)?t.compose(n.config,e):e},u=function(e){return function(n){return t.each(e,function(e,t){n.setRequestHeader(t,e)}),n}},i=function(e,n){return t.extend({},n,{config:o(u(e),n)})},s={Prefer:"return=representation"};n.token=r,n.loader=function(n,r){var o=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],u=e.prop(o),i=e.deferred();return u.load=function(){return u(!0),e.redraw(),e.startComputation(),r(t.extend({},n,{background:!0})).then(function(t){u(!1),i.resolve(t),e.endComputation()},function(t){u(!1),i.reject(t),e.endComputation()}),i.promise},u},n.loaderWithToken=function(e,t){return n.loader(e,n.requestWithToken,t)},n.init=function(o,c){return n.request=function(n){return e.request(t.extend({},n,{url:o+n.url}))},n.authenticate=function(){var t=e.deferred();return r()?t.resolve({token:r()}):e.request(c).then(function(e){r(e.token),t.resolve({token:r()})},function(e){t.reject(e)}),t.promise},n.requestWithToken=function(t){return e.postgrest.authenticate().then(function(){return e.postgrest.request(i({Authorization:"Bearer "+r()},t))},function(){return e.postgrest.request(t)})},n.model=function(r){var o=function(e,t){if(t){var n=function(){var n=(e-1)*t,r=n+t-1;return n+"-"+r};return{"Range-unit":"items",Range:n()}}},c=e.prop(10),a={url:"/"+r},d=function(e,n,r,u){var s=arguments.length<=4||void 0===arguments[4]?{}:arguments[4],c=t.extend({},{Prefer:"count=none"},s,o(n,r));return i(c,t.extend({},u,a,{method:"GET",data:e}))},p=function(t,n){return n.url+="?"+e.route.buildQueryString(t),n},f=function(n){return e.postgrest.request(t.extend({},n,a,{method:"OPTIONS"}))},g=function(e,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=t.extend({},s,r);return i(o,t.extend({},n,a,{method:"POST",data:e}))},l=function(e,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=u(t.extend({},r));return p(e,i(o,t.extend({},n,a,{method:"DELETE"})))},m=function(e,n,r){var o=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],c=u(t.extend({},s,o));return p(e,i(c,t.extend({},r,a,{method:"PATCH",data:n})))},h=function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];return d(e,t||1,c(),n,r)},v=function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return d(e,1,1,t,n)};return{pageSize:c,getPageOptions:h,getRowOptions:v,patchOptions:m,postOptions:g,deleteOptions:l,getPage:t.compose(n.request,h),getRow:t.compose(n.request,v),patch:t.compose(n.request,m),post:t.compose(n.request,g),deleteRequest:t.compose(n.request,l),getPageWithToken:t.compose(n.requestWithToken,h),getRowWithToken:t.compose(n.requestWithToken,v),patchWithToken:t.compose(n.requestWithToken,m),postWithToken:t.compose(n.requestWithToken,g),deleteWithToken:t.compose(n.requestWithToken,l),options:f}},n},e.postgrest=n}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.filtersVM=function(n){var r={},o=function(){var n=e.prop(""),o=function(e){return arguments.length>0?(n(e),r):n()};return o.toFilter=function(){return t.isString(o())?o().trim():o()},o},u=t.reduce(n,function(e,t,n){return"between"===t?e[n]={lte:o(),gte:o()}:e[n]=o(),e},{order:e.prop()}),i=function(){return t.reduce(u,function(e,r,o){if("order"!==o){var u=n[o];if(t.isFunction(r.toFilter)&&(void 0===r.toFilter()||""===r.toFilter()))return e;if("ilike"===u||"like"===u)e[o]=u+".*"+r.toFilter()+"*";else if("@@"===u)e[o]=u+"."+r.toFilter().replace(/\s+/g,"&");else if("between"===u){if(!r.lte.toFilter()&&!r.gte.toFilter())return e;e[o]=[],r.gte()&&e[o].push("gte."+r.gte.toFilter()),r.lte()&&e[o].push("lte."+r.lte.toFilter())}else e[o]=u+"."+r.toFilter()}return e},{})},s=function(){var e=function(){return u.order()&&t.reduce(u.order(),function(e,t,n){return e.push(n+"."+t),e},[]).join(",")},n=e()?{order:e()}:{};return t.extend({},n,i())};return t.extend(r,u,{parameters:s,parametersWithoutOrder:i})}}),function(e){"object"==typeof exports?e(require("mithril"),require("underscore")):e(window.m,window._)}(function(e,t){e.postgrest.paginationVM=function(n,r){var o=e.prop([]),u=r||"id.desc",i=e.prop({order:u}),s=e.prop(!1),c=e.prop(1),a=e.prop(),d=function(){var r=e.deferred(),u=function(e){if(!e||0===e.status)return JSON.stringify({hint:null,details:null,code:0,message:"Connection error"});var n=e.getResponseHeader("Content-Range");t.isString(n)&&n.split("/").length>1&&a(parseInt(n.split("/")[1]));try{return JSON.parse(e.responseText),e.responseText}catch(r){return JSON.stringify({hint:null,details:null,code:0,message:e.responseText})}};return s(!0),n(i(),c(),{background:!0,extract:u},{Prefer:"count=exact"}).then(function(n){o(t.union(o(),n)),s(!1),r.resolve(o()),e.redraw()},function(t){s(!1),a(0),r.reject(t),e.redraw()}),r.promise},p=function(e){return i(t.extend({order:u},e)),o([]),c(1),d()},f=function(){return c(c()+1),d()};return{collection:o,firstPage:p,isLoading:s,nextPage:f,total:a}}});